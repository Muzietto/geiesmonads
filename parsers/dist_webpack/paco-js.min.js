!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("paco-js",[],e):"object"==typeof exports?exports["paco-js"]=e():t["paco-js"]=e()}(this,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>ot});const r=Object.create;function n(){throw new Error("Not implemented.")}function o(){return this}function u(){}function i(t){this.value=t}function a(){}function s(){}function c(t,e){const r=new l(t,e);return r[Symbol.iterator]=function*(){yield t,yield e},r}function l(t,e){Object.defineProperty(this,0,{value:t,writable:!1}),Object.defineProperty(this,1,{value:e,writable:!1})}function p(t,e,r){const n=new f(t,e,r);return n[Symbol.iterator]=function*(){yield t,yield e,yield r},n}function f(t,e,r){Object.defineProperty(this,0,{value:t,writable:!1}),Object.defineProperty(this,1,{value:e,writable:!1}),Object.defineProperty(this,2,{value:r,writable:!1})}function y(t=[],e=0,r=0){return new h(t,e,r)}function h(t,e,r){this.rows=t,this.row=e,this.col=r}i.prototype=r(u.prototype),a.prototype=r(u.prototype),u.Nothing=function(){return new a},u.prototype.Nothing=u.Nothing,u.Just=function(t){return new i(t)},u.prototype.Just=u.Just,u.fromNullable=function(t){return null!==t?new i(t):new a},u.prototype.fromNullable=u.fromNullable,u.fromEither=function(t){return t.fold(u.Nothing,u.Just)},u.prototype.fromEither=u.fromEither,u.fromValidation=u.fromEither,u.prototype.fromValidation=u.fromEither,u.prototype.isNothing=!1,a.prototype.isNothing=!0,u.prototype.isJust=!1,i.prototype.isJust=!0,u.of=function(t){return new i(t)},u.prototype.of=u.of,u.prototype.ap=n,a.prototype.ap=o,i.prototype.ap=function(t){return t.map(this.value)},u.prototype.map=n,a.prototype.map=o,i.prototype.map=function(t){return this.of(t(this.value))},u.prototype.chain=n,a.prototype.chain=o,i.prototype.chain=function(t){return t(this.value)},u.prototype.toString=n,a.prototype.toString=function(){return"Maybe.Nothing"},i.prototype.toString=function(){return"Maybe.Just("+this.value+")"},u.prototype.isEqual=n,a.prototype.isEqual=function(t){return t.isNothing},i.prototype.isEqual=function(t){return t.isJust&&t.value===this.value},u.prototype.get=n,a.prototype.get=function(){throw new TypeError("Can't extract the value of a Nothing.")},i.prototype.get=function(){return this.value},u.prototype.getOrElse=n,a.prototype.getOrElse=function(t){return t},i.prototype.getOrElse=function(t){return this.value},u.prototype.orElse=n,a.prototype.orElse=function(t){return t()},i.prototype.orElse=function(t){return this},u.prototype.cata=n,a.prototype.cata=function(t){return t.Nothing()},i.prototype.cata=function(t){return t.Just(this.value)},u.prototype.toJSON=n,a.prototype.toJSON=function(){return{"#type":"folktale:Maybe.Nothing"}},i.prototype.toJSON=function(){return{"#type":"folktale:Maybe.Just",value:this.value}},c.prototype=Object.create(s.prototype),l.prototype.isPair=!0,l.prototype.type="pair",l.prototype.toString=function(){return"["+this[0].toString()+","+this[1].toString()+"]"},p.prototype=Object.create(s.prototype),f.prototype.isTriple=!0,f.prototype.type="triple",f.prototype.toString=function(){return"["+this[0].toString()+","+this[1].toString()+","+this[2].toString()+"]"},s.Pair=c,s.prototype.Pair=c,s.Triple=p,s.prototype.Triple=p,y.fromText=function(t){return new h(t.split("\n").map((t=>t.split(""))),0,0)},h.prototype.isPosition=!0,h.prototype.char=function(){let t=u.Nothing();try{const e=this.rows[this.row][this.col];void 0!==e&&(t=u.Just(e))}catch(t){}return t},h.prototype.incrPos=function(t=0){const e=this.rows.length-1,r=this.rows[e].length-1;let n=y(this.rows,e,r+1);try{const e=this.col===this.rows[this.row].length-1;return n=1*t?function t(e,r=0){return 0===r?e:t(e.incrPos(),r-1)}(this,t):y(this.rows,e?this.row+1:this.row,e?0:this.col+1),n}catch(t){}return n},h.prototype.decrPos=function(t=0){let e=y(this.rows,-1,-1);try{const r=0===this.col;return e=t?function t(e,r=0){return 0===r?e:t(e.decrPos(),r-1)}(this,t):y(this.rows,r?this.row-1:this.row,r?this.rows[this.row-1].length-1:this.col-1),e}catch(t){}return e},h.prototype.rest=function(){const t=this;return function(){const e=t.char();return e.isNothing?[]:[e.value].concat(t.incrPos().rest())}().join("")},h.prototype.toString=function(){return"row="+this.row+";col="+this.col+";rest="+this.rest()};const d=Object.create;function b(){throw new Error("Not implemented.")}function v(){return this}function P(){}function g(t){this.value=t}function m(t){this.value=t}g.prototype=d(P.prototype),m.prototype=d(P.prototype),P.Failure=function(t){return new g(t)},P.prototype.Failure=P.Failure,P.Success=function(t){return new m(t)},P.prototype.Success=P.Success,P.fromNullable=function(t){return null!==t?new m(t):new g(t)},P.prototype.fromNullable=P.fromNullable,P.fromEither=function(t){return t.fold(P.Failure,P.Success)},P.prototype.isFailure=!1,g.prototype.isFailure=!0,P.prototype.isSuccess=!1,m.prototype.isSuccess=!0,P.of=function(t){return new m(t)},P.prototype.of=P.of,P.prototype.ap=b,g.prototype.ap=function(t){return t.isFailure?this.Failure(this.value.concat(t.value)):this},m.prototype.ap=function(t){return t.isFailure?t:t.map(this.value)},P.prototype.map=b,g.prototype.map=v,m.prototype.map=function(t){return this.of(t(this.value))},P.prototype.toString=b,g.prototype.toString=function(){return"Validation.Failure("+this.value.toString()+")"},m.prototype.toString=function(){return"Validation.Success("+this.value.toString()+")"},P.prototype.isEqual=b,g.prototype.isEqual=function(t){return t.isFailure&&t.value===this.value},m.prototype.isEqual=function(t){return t.isSuccess&&t.value===this.value},P.prototype.get=b,g.prototype.get=function(){throw new TypeError("Can't extract the value of a Failure(a).")},m.prototype.get=function(){return this.value},P.prototype.getOrElse=b,g.prototype.getOrElse=function(t){return t},m.prototype.getOrElse=function(t){return this.value},P.prototype.orElse=b,m.prototype.orElse=v,g.prototype.orElse=function(t){return t(this.value)},P.prototype.merge=function(){return this.value},P.prototype.fold=b,g.prototype.fold=function(t,e){return t(this.value)},m.prototype.fold=function(t,e){return e(this.value)},P.prototype.cata=b,g.prototype.cata=function(t){return t.Failure(this.value)},m.prototype.cata=function(t){return t.Success(this.value)},P.prototype.swap=b,g.prototype.swap=function(){return this.Success(this.value)},m.prototype.swap=function(){return this.Failure(this.value)},P.prototype.bimap=b,g.prototype.bimap=function(t,e){return this.Failure(t(this.value))},m.prototype.bimap=function(t,e){return this.Success(e(this.value))},P.prototype.failureMap=b,m.prototype.failureMap=v,g.prototype.failureMap=function(t){return this.Failure(t(this.value))},P.prototype.leftMap=P.prototype.failureMap,m.prototype.leftMap=m.prototype.failureMap,g.prototype.leftMap=g.prototype.failureMap;const w=t=>e=>{"string"==typeof e&&(e=y.fromText(e));const r=e.char();return r.isNothing?P.Failure(s.Triple("charParser","no more input",e)):r.value===t?P.Success(s.Pair(t,e.incrPos())):P.Failure(s.Triple("charParser","wanted "+t+"; got "+r.value,e))},S=t=>e=>{"string"==typeof e&&(e=y.fromText(e));const r=e.char();return r.isNothing?P.Failure(s.Triple("digitParser","no more input",e)):parseInt(r.value,10)===t?P.Success(s.Pair(t,e.incrPos())):P.Failure(s.Triple("digitParser","wanted "+t+"; got "+r.value,e))},F=nt((t=>t.decrPos().char().isNothing?M.run(t):J.run(t))).setLabel("^"),T=nt((t=>t.decrPos().char().isJust?M.run(t):J.run(t))).setLabel("not^"),E=nt((t=>""===t.rest()?M.run(t):J.run(t))).setLabel("$"),L=nt((t=>""!==t.rest()?M.run(t):J.run(t))).setLabel("not$");function N(t){const e="pchar_"+t;return nt((e=>w(t)(e)),e).setLabel(e)}function O(t,e){const r=t.label+" andThen "+e.label;return nt((n=>{const o=t.run(n);if(o.isSuccess){const t=e.run(o.value[1]);return t.isSuccess?P.Success(s.Pair(s.Pair(o.value[0],t.value[0]),t.value[1])):P.Failure(s.Triple(r,t.value[1],t.value[2]))}return P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)}function j(t,e){const r=t.label+" orElse "+e.label;return nt((n=>{const o=t.run(n);if(o.isSuccess)return o;const u=e.run(n);return u.isSuccess?u:P.Failure(s.Triple(r,u.value[1],u.value[2]))}),r).setLabel(r)}const J=nt((t=>P.Failure(s.Triple("","fail",t)))).setLabel("failP"),M=nt((t=>P.Success(s.Pair("",t),"succeed"))).setLabel("succeedP");function x(t){return t.reduceRight(((t,e)=>j(e,t)),J).setLabel("choice "+t.reduce(((t,e)=>t+"/"+e.label),""))}function B(t){return x(t.map(N)).setLabel("anyOf "+t.reduce(((t,e)=>t+e),""))}const q=B(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]).setLabel("lowercaseP"),C=B(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]).setLabel("uppercaseP"),I=q.orElse(C).setLabel("letterP"),V=B(["0","1","2","3","4","5","6","7","8","9"]).setLabel("digitP"),k=B([" ","\t","\n","\r"]).setLabel("whiteP");function R(t,e){const r=e.label+" fmap "+t.toString();return nt((n=>{const o=e.run(n);return o.isSuccess?P.Success(s.Pair(t(o.value[0]),o.value[1])):P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)}function $(t){return nt((e=>P.Success(s.Pair(t,e)))).setLabel(`returnP ${t.toString()}`)}function z(t){return function(e){return t.bind((t=>e.bind((e=>$(t(e))))))}}function _(t){return function(e){return function(r){return $(t).apply(e).apply(r)}}}function A(t){return t.reduceRight(((t,e)=>_(rt)(e)(t)),$([]))}function D(t){return A(t.split("").map(N)).setLabel("pstring "+t)}function G(t){return e=>{const r=t.run(e);if(r.isFailure)return P.Success(s.Pair([],e));const n=G(t)(r.value[1]);return P.Success(s.Pair([r.value[0]].concat(n.value[0]),n.value[1]))}}function H(t,e){const r=void 0!==e,n="many "+t.label+(r?" times="+e:"");return nt((o=>{const u=G(t)(o);if(r){if(u.isFailure)return u;const t=u.value[0].length;return t===e?u:P.Failure(s.Triple(n,"times param wanted "+e+"; got "+t,o))}return u}),n).setLabel(n)}function K(t){const e="many1 "+t.label;return nt((e=>{const r=t.run(e);if(r.isFailure)return r;const n=G(t)(r.value[1]);return P.Success(s.Pair([r.value[0]].concat(n.value[0]),n.value[1]))}),e).setLabel(e)}function Q(t,e){const r=void 0!==e,n="opt "+t.label+(r?"(default="+e+")":"");return nt((n=>{const o=t.fmap(u.Just).run(n);if(o.isSuccess)return o;const i=r?u.Just(e):u.Nothing();return P.Success(s.Pair(i,n))}),n).setLabel(n)}function U(t,e){const r=t.label+" discardSecond "+e.label;return nt((r=>O(t,e).fmap((([t,e])=>t)).run(r)),r).setLabel(r)}function W(t,e){const r=t.label+" discardFirst "+e.label;return nt((r=>O(t,e).fmap((([t,e])=>e)).run(r)),r).setLabel(r)}function X(t,e){return t.andThen(H(e.discardFirst(t))).fmap((([t,e])=>[t].concat(e)))}function Y(t,e,r){return t.discardFirst(e).discardSecond(r).setLabel("between "+t.label+"/"+e.label+"/"+r.label)}function Z(t,e){const r="bindP applied to "+e.label;return nt((r=>{const n=e.run(r);return n.isFailure?n:t(n.value[0]).run(n.value[1])}),r).setLabel(r)}function tt(t,e){return t.bind((t=>(e(t),$(t))))}function et(t){return Q(H(k)).discardFirst(t).discardSecond(Q(H(k))).setLabel("trim "+t.label)}function rt(t){return function(e){return[t].concat(e)}}function nt(t,e){return{type:"parser",label:e,run:e=>t(e),apply(t){return z(this)(t)},fmap(t){return this.bind((e=>$(t(e))))},andThen(t){return O(this,t)},orElse(t){return j(this,t)},discardFirst(t){return W(this,t)},discardSecond(t){return U(this,t)},bind(t){return Z(t,this)},setLabel(t){return function(t,e){return nt((r=>{const n=t.run(r);return n.isFailure?P.Failure(s.Triple(e,n.value[1],n.value[2])):n}),e)}(this,t)}}}const ot={charParser:w,digitParser:S,predicateBasedParser:(t,e)=>r=>{"string"==typeof r&&(r=y.fromText(r));const n=r.char();return n.isNothing?P.Failure(s.Triple(e,"no more input",r)):t(n.value)?P.Success(s.Pair(n.value,r.incrPos())):P.Failure(s.Triple(e,"unexpected char: "+n.value,r))},startOfInputP:F,notStartOfInputP:T,endOfInputP:E,notEndOfInputP:L,pchar:N,pdigit:function(t){return nt((e=>S(t)(e)),"pdigit_"+t)},precededByP:function(t,e){const r=e+" preceded by "+t;return nt((n=>{const o=N(e).run(n);if(o.isSuccess){const n=N(t).run(o.value[1].decrPos(2));return n.isSuccess?P.Success(s.Pair(e,o.value[1])):P.Failure(s.Triple(r,n.value[1],n.value[2]))}return P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)},notPrecededByP:function(t,e){const r=e+" not preceded by "+t;return nt((n=>{const o=N(e).run(n);if(o.isSuccess){let n=P.Failure();try{n=N(t).run(o.value[1].decrPos(2))}catch(t){}return n.isFailure?P.Success(s.Pair(e,o.value[1])):P.Failure(s.Triple(r,n.value[1],n.value[2]))}return P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)},followedByP:function(t,e){const r=e+" followed by "+t;return nt((n=>{const o=N(e).run(n);if(o.isSuccess){const n=N(t).run(o.value[1]);return n.isSuccess?P.Success(s.Pair(e,o.value[1])):P.Failure(s.Triple(r,n.value[1],n.value[2]))}return P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)},notFollowedByP:function(t,e){const r=e+" not followed by "+t;return nt((n=>{const o=N(e).run(n);if(o.isSuccess){let n=P.Failure();try{n=N(t).run(o.value[1])}catch(t){}return n.isFailure?P.Success(s.Pair(e,o.value[1])):P.Failure(s.Triple(r,n.value[1],n.value[2]))}return P.Failure(s.Triple(r,o.value[1],o.value[2]))}),r)},andThen:O,andThenBind:function(t,e){return t.bind((t=>e.bind((e=>$(s.Pair(t,e)))))).setLabel(t.label+" andThen "+e.label)},orElse:j,failP:J,succeedP:M,choice:x,anyOf:B,lowercaseP:q,uppercaseP:C,letterP:I,digitP:V,whiteP:k,fmap:R,returnP:$,applyPx:function(t){return function(e){return O(t,e).fmap((([t,e])=>t(e)))}},applyP:z,lift2:_,sequenceP:A,sequenceP2:function(t){return t.reduceRight(((t,e)=>R((([t,e])=>t+e),O(e,t))),$(""))},pstring:D,stringP:function(t){return D(t).fmap((t=>t.join(""))).setLabel("stringP "+t)},zeroOrMore:G,many:H,manyChars:function(t,e){return H(t,e).fmap((t=>t.join(""))).setLabel("manyChars "+t.label+(void 0!==e?" times="+e:""))},many1:K,manyChars1:function(t){return K(t).fmap((t=>t.join(""))).setLabel("manyChars1 "+t.label)},opt:Q,optBook:function(t){const e=t.fmap(u.Just),r=$(u.Nothing);return e.orElse(r)},discardSecond:U,discardFirst:W,sepBy1:X,sepBy1Marco:function(t,e){return H(K(t).discardSecond(Q(e))).fmap((t=>t.map((([t])=>t))))},sepBy:function(t,e){return X(t,e).orElse($([]))},between:Y,betweenParens:function(t){return Y(N("("),t,N(")")).setLabel("betweenParens "+t.label)},bindP:Z,tapP:tt,logP:function(t){return tt(t,(e=>console.log(t.label+":"+e)))},pword:function(t){return et(D(t)).setLabel("pword "+t)},trimP:et,parser:nt};return e.default})()));